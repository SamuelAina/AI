ALTER function  [dbo].[Calculate_Commission_LCCY_V2024]  
(  
  @Transaction_Type   VARCHAR(255)  
  ,@Commission_Scheme  VARCHAR(255)  
  ,@Notional_LCCY      money   
  ,@Price_pcnt         money  
  ,@Credit_Grade    VARCHAR(10)  
  ,@Commission_Non_Standard_pcnt MONEY  
  ,@Distribution_Type  VARCHAR(255)  
)  
RETURNS    DECIMAL(38,2)  
AS  
BEGIN  
DECLARE @Commission_LCCY    MONEY  
DECLARE @Commission_pcnt    MONEY   
    select  @Commission_pcnt = [Commission %] from [Commission Grid Table] WHERE [Credit Grade (CG)]=@Credit_Grade  
/*  
--variables  
@Transaction_Type     
@Commission_Scheme   
@Notional_LCCY         
@Price_pcnt           
@Credit_Grade   
@Commission_Non_Standard_pcnt  
@Distribution_Type       
*/  
 
/*
Existing Dropdown			New Dropdown
F*RISK Asset Book Sale		Hold Book Sale
C*PM Sale					Hold Book Sale
P*M							Hold Book Sale
S*YNDICATIONS				Primary Bookbuild Sale 
G*SAM						SAR Sale 
*/
SELECT  @Commission_LCCY= NULL --this means manual  
IF @Commission_Scheme ='STANDARD'  
BEGIN  
  IF @Transaction_Type='BUY'   
  BEGIN  
    IF @Distribution_Type IN ('SAR Sale','Hold Book Sale','PEF Warehouse Sale','Primary Bookbuild Sale - TURKISH FI')   
    BEGIN   
      IF @Notional_LCCY * @Price_pcnt/100 * 0.25/100 > 25000  
      BEGIN  
         SELECT  @Commission_LCCY= @Notional_LCCY * @Price_pcnt/100 * 0.25/100  
      END  
      ELSE  
      BEGIN  
        SELECT  @Commission_LCCY= 25000  
      END   
    END  
  END  
--SELECT DISTINCT [Transaction Type],[Distribution Type] FROM [Tracker_SecondaryLoansSales_starting_from_2024].dbo.bugs
  IF @Transaction_Type='SELL'   
  BEGIN  
    IF @Distribution_Type ='SAR Sale'   
    BEGIN  
       SELECT @Commission_LCCY=@Notional_LCCY * @Price_pcnt/100 * @Commission_pcnt/100  
    END   
    IF @Distribution_Type IN ('Hold Book Sale','Primary Bookbuild Sale - TURKISH FI')   
    BEGIN  
       SELECT @Commission_LCCY=@Notional_LCCY * @Price_pcnt/100 * @Commission_pcnt/100  
    END   
  END  
END  
ELSE   
BEGIN  
  IF @Transaction_Type IN ('BUY','SELL')   
  BEGIN  
    IF @Distribution_Type IN ('SAR Sale','Hold Book Sale','Primary Bookbuild Sale - TURKISH FI')   
    BEGIN   
      SELECT @Commission_LCCY=@Notional_LCCY * @Price_pcnt/100 * @Commission_Non_Standard_pcnt/100  
    END  
  END  
END  
RETURN  @Commission_LCCY  
END  
